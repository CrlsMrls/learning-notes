# Falco

Falco (https://falco.org/) is a runtime security tool that can be used to detect unexpected application behavior. It is based on the Linux kernel's `eBPF` feature and can be used to monitor system calls, file access, and network activity. 

## Configuration

To configure Falco, modify the  `/etc/falco/falco.yaml` file.

The rules for Falco are stored in the `/etc/falco/falco_rules.yaml` file. The last rule takes precedence over the previous rules.

## Logs

Falco generates logs for each event it detects. 

When Falco is running as a Linux daemon, the logs can be inspected using the following command:

```bash
$ journalctl -u falco
```

## Alert

When Falco detects an unexpected behavior, it generates an alert. The alert is displayed in the logs and can be used to identify the issue.

Generate an alert by executing a command in a container that violates the Falco rules:

```bash
$ kubectl exec simple-webapp-1 -n critical-apps -- apt update
```

Example output:

```bash
$ journalctl -u falco
controlplane falco[6722]: Error Package management process launched in container (user=<NA> user_loginuid=-1 command=apt update pid=9610 container_id=7939f7035e61 container_name=simple-webapp-1 image=docker.io/library/nginx:latest namespace=critical-apps)
```

The previous output shows that the `apt update` command was executed in the `simple-webapp-1` under the `critical-apps` namespace. With a priority level of `Error`.

This alert was defined in the Falco rules file. Opening the `/etc/falco/falco_rules.yaml` file, the rule is:

```yaml
- rule: Launch Package Management Process in Container
  desc: Package management process ran inside container
  condition: >
    spawned_process
    and container
    and user.name != "_apt"
    and package_mgmt_procs
    and not package_mgmt_ancestor_procs
    and not user_known_package_manager_in_container
    and not pkg_mgmt_in_kube_proxy
  output: >
    Package management process launched in container (user=%user.name user_loginuid=%user.loginuid
    command=%proc.cmdline pid=%proc.pid container_id=%container.id container_name=%container.name image=%container.image.repository:%container.image.tag)
  priority: ERROR
  tags: [process, mitre_persistence]
```

Modifying the rules file allows you to customize the alerts generated by Falco. After modifying the rules file, restart the Falco service to apply the changes.


## References

- https://falco.org/docs/getting-started/installation/
- https://github.com/falcosecurity/charts/tree/master/falco
- https://falco.org/docs/rules/supported-fields/
- https://falco.org/docs/rules/default-macros/
- https://falco.org/docs/configuration/

